define(["angular","d3"],function(a,b){var c=a.module("angularCharts",["angularChartsTemplates"]);return a.module("angularCharts",["angularChartsTemplates"]),a.module("angularCharts").directive("acChart",["$templateCache","$compile","$rootElement","$window","$timeout","$sce",function(c,d,e,f,g,h){function i(){var a=(Math.round(127*Math.random())+127).toString(16),b=(Math.round(127*Math.random())+127).toString(16),c=(Math.round(127*Math.random())+127).toString(16);return"#"+a+b+c}function j(b,c){var d=null;for(var e in b)if(a.isElement(b[e])&&(d=a.element(b[e]),d.hasClass(c)))return d;return d}function k(e,k){function m(){p(),n(),o();var a=q(O);a(),A()}function n(){if(!E.legend.display)return K=G,void(L=F);switch(E.legend.position){case"top":case"bottom":K=.75*G,L=F;break;case"left":case"right":K=G,L=.75*F}}function o(){var a=c.get("angularChartsTemplate_"+E.legend.position);k.html(a),d(k.contents())(e);var b=k.find("div");M=j(b,"ac-chart"),N=j(b,"ac-legend"),K-=j(b,"ac-title")[0].clientHeight}function p(){H=e.acData,O=e.acChart,I=H?H.series||[]:[],J=H?H.data||[]:[],e.acConfig&&a.extend(E,e.acConfig)}function q(a){var b={pie:v,bar:s,line:t,area:u,point:w};return b[a]}function r(a,b){var c=b.domain();if(E.xAxisMaxTicks&&c.length>E.xAxisMaxTicks){var d=Math.ceil(c.length/E.xAxisMaxTicks);a.tickValues(c.filter(function(a,b){return b%d===0}))}}function s(){var c={top:0,right:20,bottom:30,left:40};L-=c.left+c.right,K-=c.top+c.bottom;var d=b.scale.ordinal().rangeRoundBands([0,L],.1),f=b.scale.linear().range([K,10]),g=b.scale.ordinal().rangeRoundBands([0,L],.1),h=[0];J.forEach(function(b){b.nicedata=b.y.map(function(c,d){return h.push(c),{x:b.x,y:c,s:d,tooltip:a.isArray(b.tooltip)?b.tooltip[d]:b.tooltip}})});var i=b.max(J.map(function(a){return a.y.length}));e.yMaxData=i,d.domain(J.map(function(a){return a.x}));var j=.2*b.max(h);f.domain([b.min(h),b.max(h)+j]),g.domain(b.range(i)).rangeRoundBands([0,d.rangeBand()]);var k=b.svg.axis().scale(d).orient("bottom");r(k,d);var l=b.svg.axis().scale(f).orient("left").ticks(10).tickFormat(b.format(E.yAxisTickFormat)),m=b.select(M[0]).append("svg").attr("width",L+c.left+c.right).attr("height",K+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")");m.append("g").attr("class","x axis").attr("transform","translate(0,"+K+")").call(k),m.append("g").attr("class","y axis").call(l);var n=m.selectAll(".state").data(J).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+d(a.x)+",0)"}),o=n.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");o.attr("width",g.rangeBand()),o.attr("x",function(a,b){return g(b)}).attr("y",K).style("fill",function(a){return D(a.s)}).attr("height",0).transition().ease("cubic-in-out").duration(E.isAnimate?1e3:0).attr("y",function(a){return f(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(f(a.y)-f(0))}),o.on("mouseover",function(a){x({index:a.x,value:a.tooltip?a.tooltip:a.y,series:I[a.s]},b.event),E.mouseover(a,b.event),e.$apply()}).on("mouseleave",function(a){y(),E.mouseout(a,b.event),e.$apply()}).on("mousemove",function(a){z(a,b.event)}).on("click",function(a){E.click.call(a,b.event),e.$apply()}),E.labels&&n.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("x",function(a,b){return g(b)}).attr("y",function(a){return K-Math.abs(f(a.y)-f(0))}).text(function(a){return a.y}),m.append("line").attr("x1",L).attr("y1",f(0)).attr("y2",f(0)).style("stroke","silver")}function t(){function c(a){return Math.round(f(a))+f.rangeBand()/2}var d={top:0,right:40,bottom:20,left:40};L-=d.left+d.right,K-=d.top+d.bottom;var f=b.scale.ordinal().domain(J.map(function(a){return a.x})).rangeRoundBands([0,L]),g=b.scale.linear().range([K,10]),h=b.svg.axis().scale(f).orient("bottom");r(h,f);var i=b.svg.axis().scale(g).orient("left").ticks(5).tickFormat(b.format(E.yAxisTickFormat)),j=b.svg.line().interpolate(E.lineCurveType).x(function(a){return c(a.x)}).y(function(a){return g(a.y)}),k=[0],l=[];J.forEach(function(a){a.y.map(function(a){k.push(a)})});var m=b.max(J.map(function(a){return a.y.length}));e.yMaxData=m,I.slice(0,m).forEach(function(a,b){var c={};c.series=a,c.values=J.map(function(a){return a.y.map(function(b){return{x:a.x,y:b,tooltip:a.tooltip}})[b]||{x:J[b].x,y:0}}),l.push(c)});var n=b.select(M[0]).append("svg").attr("width",L+d.left+d.right).attr("height",K+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")"),o=.2*b.max(k);g.domain([b.min(k),b.max(k)+o]),n.append("g").attr("class","x axis").attr("transform","translate(0,"+K+")").call(h),n.append("g").attr("class","y axis").call(i);var p=n.selectAll(".points").data(l).enter().append("g"),q=p.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(a,b){return D(b)}).attr("d",function(a){return j(a.values)}).attr("stroke-width","2").attr("fill","none");if(l.length>0){var s=l[l.length-1].values;if(s.length>0){var t=q.node().getTotalLength()+c(s[s.length-1].x);q.attr("stroke-dasharray",t+" "+t).attr("stroke-dashoffset",t).transition().duration(E.isAnimate?1500:0).ease("linear").attr("stroke-dashoffset",0).attr("d",function(a){return j(a.values)})}}return a.forEach(l,function(a){var d=n.selectAll(".circle").data(a.values).enter();d.append("circle").attr("cx",function(a){return c(a.x)}).attr("cy",function(a){return g(a.y)}).attr("r",3).style("fill",D(l.indexOf(a))).style("stroke",D(l.indexOf(a))).on("mouseover",function(a){return function(c){x({index:c.x,value:c.tooltip?c.tooltip:c.y,series:a},b.event),E.mouseover(c,b.event),e.$apply()}}(a.series)).on("mouseleave",function(a){y(),E.mouseout(a,b.event),e.$apply()}).on("mousemove",function(){z(b.event)}).on("click",function(a){E.click(a,b.event),e.$apply()}),E.labels&&d.append("text").attr("x",function(a){return c(a.x)}).attr("y",function(a){return g(a.y)}).text(function(a){return a.y})}),"lineEnd"===E.lineLegend&&p.append("text").datum(function(a){return{name:a.series,value:a.values[a.values.length-1]}}).attr("transform",function(a){return"translate("+c(a.value.x)+","+g(a.value.y)+")"}).attr("x",3).text(function(a){return a.name}),l}function u(){function a(a){return Math.round(d(a))+d.rangeBand()/2}var c={top:0,right:40,bottom:20,left:40};L-=c.left+c.right,K-=c.top+c.bottom;var d=b.scale.ordinal().domain(J.map(function(a){return a.x})).rangePoints([0,L]),f=b.scale.linear().range([K,10]),g=b.svg.axis().scale(d).orient("bottom");r(g,d);var h=b.svg.axis().scale(f).orient("left").ticks(5).tickFormat(b.format(E.yAxisTickFormat));b.svg.line().interpolate(E.lineCurveType).x(function(b){return a(b.x)}).y(function(a){return f(a.y)});var i=[0],j=[];J.forEach(function(a){a.y.map(function(a){i.push(a)})});var k=b.max(J.map(function(a){return a.y.length}));e.yMaxData=k,I.slice(0,k).forEach(function(a,b){var c={};c.series=a,c.values=J.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:J[b].x,y:0}}),j.push(c)});var l=b.select(M[0]).append("svg").attr("width",L+c.left+c.right).attr("height",K+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")"),m=.2*b.max(i);f.domain([b.min(i),b.max(i)+m]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+K+")").call(g),l.append("g").attr("class","y axis").call(h);var n=l.selectAll(".points").data(j).enter().append("g"),o=b.svg.area().interpolate("basis").x(function(b){return a(b.x)}).y0(function(){return f(0)}).y1(function(a){return f(0+a.y)});n.append("path").attr("class","area").attr("d",function(a){return o(a.values)}).style("fill",function(a,b){return D(b)}).style("opacity","0.7")}function v(){function a(a){a.innerRadius=0;var c=b.interpolate({startAngle:0,endAngle:0},a);return function(a){return h(c(a))}}var c=Math.min(L,K)/2,d=b.select(M[0]).append("svg").attr("width",L).attr("height",K).append("g").attr("transform","translate("+L/2+","+K/2+")"),f=0;if(E.innerRadius){var g=E.innerRadius;g="string"==typeof g&&g.indexOf("%")>0?.01*c*parseFloat(g):Number(g),g>=0&&(f=g)}e.yMaxData=J.length;var h=b.svg.arc().outerRadius(c-10).innerRadius(f);b.svg.arc().outerRadius(c+5).innerRadius(0);var i=b.layout.pie().sort(null).value(function(a){return a.y[0]}),j=d.selectAll(".arc").data(i(J)).enter().append("g"),k=!1;j.append("path").style("fill",function(a,b){return D(b)}).transition().ease("linear").duration(E.isAnimate?500:0).attrTween("d",a).attr("class","arc").each("end",function(){k||(k=!0,j.on("mouseover",function(a){x({value:a.data.tooltip?a.data.tooltip:a.data.y[0]},b.event),b.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),E.mouseover(a,b.event),e.$apply()}).on("mouseleave",function(a){b.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),y(),E.mouseout(a,b.event),e.$apply()}).on("mousemove",function(a){z(a,b.event)}).on("click",function(a){E.click(a,b.event),e.$apply()}))}),E.labels&&j.append("text").attr("transform",function(a){return"translate("+h.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.y[0]})}function w(){function c(a){return Math.round(f(a))+f.rangeBand()/2}var d={top:0,right:40,bottom:20,left:40};L-=d.left-d.right,K-=d.top-d.bottom;var f=b.scale.ordinal().domain(J.map(function(a){return a.x})).rangeRoundBands([0,L]),g=b.scale.linear().range([K,10]),h=b.svg.axis().scale(f).orient("bottom");r(h,f);var i=b.svg.axis().scale(g).orient("left").ticks(5).tickFormat(b.format(E.yAxisTickFormat)),j=[0],k=[];J.forEach(function(a){a.y.map(function(a){j.push(a)})});var l=b.max(J.map(function(a){return a.y.length}));e.yMaxPoints=l,I.slice(0,l).forEach(function(a,b){var c={};c.series=a,c.values=J.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:J[b].x,y:0}}),k.push(c)});var m=b.select(M[0]).append("svg").attr("width",L+d.left+d.right).attr("height",K+d.top+d.bottom).append("g").attr("transform","translate("+d.left+","+d.top+")"),n=.2*b.max(j);g.domain([b.min(j),b.max(j)+n]),m.append("g").attr("class","x axis").attr("transform","translate(0,"+K+")").call(h),m.append("g").attr("class","y axis").call(i),m.selectAll(".points").data(k).enter().append("g"),a.forEach(k,function(a){var d=m.selectAll(".circle").data(a.values).enter();d.append("circle").attr("cx",function(a){return c(a.x)}).attr("cy",function(a){return g(a.y)}).attr("r",3).style("fill",D(k.indexOf(a))).style("stroke",D(k.indexOf(a))).on("mouseover",function(a){return function(c){x({index:c.x,value:c.tooltip?c.tooltip:c.y,series:a},b.event),E.mouseover(c,b.event),e.$apply()}}(a.series)).on("mouseleave",function(a){y(),E.mouseout(a,b.event),e.$apply()}).on("mousemove",function(){z(b.event)}).on("click",function(a){E.click(a,b.event),e.$apply()}),E.labels&&d.append("text").attr("x",function(a){return c(a.x)}).attr("y",function(a){return g(a.y)}).text(function(a){return a.y})})}function x(b,c){if(E.tooltips){b="function"==typeof E.tooltips?E.tooltips(b):b.value;var d=a.element('<p class="ac-tooltip"></p>').html(b).css({left:c.pageX+20+"px",top:c.pageY-30+"px"});a.element(document.querySelector(".ac-tooltip")).remove(),a.element(document.body).append(d),e.$tooltip=d}}function y(){e.$tooltip&&e.$tooltip.remove()}function z(a,b){e.$tooltip&&e.$tooltip.css({left:b.pageX+20+"px",top:b.pageY-30+"px"})}function A(){e.legends=[],"pie"===O&&a.forEach(J,function(a,b){e.legends.push({color:E.colors[b],title:C(a.x)})}),("bar"===O||"area"===O||"point"===O||"line"===O&&"traditional"===E.lineLegend)&&a.forEach(I,function(a,b){e.legends.push({color:E.colors[b],title:C(a)})})}function B(a){return String(a).replace(/[&<>"'\/]/g,function(a){return P[a]})}function C(a){return h.trustAsHtml(E.legend.htmlEnabled?a:B(a))}function D(a){if(a<E.colors.length)return E.colors[a];var b=i();return E.colors.push(b),b}var E={title:"",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"left",htmlEnabled:!1},colors:l,innerRadius:0,lineLegend:"lineEnd",lineCurveType:"cardinal",isAnimate:!0,yAxisTickFormat:"s"},F=k[0].clientWidth,G=k[0].clientHeight;if(0===G||0===F)throw new Error("Please set height and width for the chart element");var H,I,J,K,L,M,N,O,P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},Q=a.element(f),R=null;Q.bind("resize",function(){R&&g.cancel(R),R=g(function(){F=k[0].clientWidth,G=k[0].clientHeight,m()},100)}),e.getWindowDimensions=function(){return{h:Q[0].clientHeight,w:Q[0].clientWidth}},e.$watch("[acChart, acData, acConfig]",m,!0),e.$watch(function(){return{w:k[0].clientWidth,h:k[0].clientHeight}},function(a){F=a.w,G=a.h,m()},!0)}var l=["rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)"];return{restrict:"EA",link:k,transclude:"true",scope:{acChart:"=",acData:"=",acConfig:"="}}}]),a.module("angularChartsTemplates",[]),c});